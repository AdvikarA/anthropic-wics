"use strict";(()=>{var e={};e.id=634,e.ids=[634],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},87561:e=>{e.exports=require("node:fs")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},71267:e=>{e.exports=require("worker_threads")},59796:e=>{e.exports=require("zlib")},88539:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>y,originalPathname:()=>I,patchFetch:()=>S,requestAsyncStorage:()=>m,routeModule:()=>f,serverHooks:()=>w,staticGenerationAsyncStorage:()=>b,staticGenerationBailout:()=>v});var s={};r.r(s),r.d(s,{GET:()=>g});var o=r(95419),i=r(69108),n=r(99678),a=r(98984),l=r(83949),c=r(68687),u=r(6517);let h=process.env.NEWS_API_KEY||"";async function g(e){let t=null,s=()=>{t&&(clearTimeout(t),t=null)};try{let o=new URL(e.url),i="true"===o.searchParams.get("refresh"),n="true"===o.searchParams.get("dynamic");if(!i){try{let{getNewsStories:e}=await r.e(862).then(r.bind(r,76862));if("function"==typeof e){let t=await e();if(t?.length>0)return console.log(`Serving ${t.length} stored stories from Supabase without refresh`),a.NextResponse.json({newsStories:t,timestamp:new Date().toISOString()},{status:200})}}catch(e){console.error("Error loading stored stories when no refresh parameter:",e)}return console.log("No refresh parameter found and no stored stories, returning empty array"),a.NextResponse.json({newsStories:[],timestamp:new Date().toISOString()},{status:200})}console.log("Refresh parameter found, fetching news...");let c=null,g=null;try{let e=await r.e(862).then(r.bind(r,76862));if(c=e.getNewsStories,g=e.saveNewsStory,"function"==typeof c)try{let e=await c();if(e&&e.length>0)return console.log(`Found ${e.length} existing stories in Supabase`),a.NextResponse.json({newsStories:e,timestamp:new Date().toISOString()},{status:200})}catch(e){console.error("Error fetching from Supabase:",e)}}catch(e){console.error("Error importing Supabase service:",e)}if(!n)try{let{getNewsStories:e}=await r.e(862).then(r.bind(r,76862));if("function"==typeof e){let t=await e();if(t?.length>0)return console.log(`Serving ${t.length} stored stories from Supabase`),a.NextResponse.json({newsStories:t,timestamp:new Date().toISOString()},{status:200})}}catch(e){console.error("Error loading stored stories:",e)}console.log("Refresh parameter found, fetching from NewsAPI..."),new Promise((e,r)=>{t=setTimeout(()=>{r(Error("Request timed out after 60 seconds"))},6e4)}),console.log("Fetching news from NewsAPI..."),console.log("Using NewsAPI key:",h?"Key is set":"Key is NOT set");let f=[],m=["cnn","fox-news","the-washington-post","politico","nbc-news","abc-news","bbc-news","reuters","associated-press","bloomberg","the-wall-street-journal"],b=m.slice(0,15);try{let{data:e}=await u.O.from("news_analysis").select("sources, created_at").gte("created_at",new Date(Date.now()-864e5).toISOString()),t=new Set;if(e&&e.length>0){for(let r of e)Array.isArray(r.sources)&&r.sources.forEach(e=>{e.source&&t.add(e.source.toLowerCase())});let r=b.filter(e=>!t.has(e));console.log(`Filtered out ${b.length-r.length} already covered sources`),b=r}}catch(e){console.error("Error checking for recent sources:",e)}for(let e of(console.log(`Limiting dynamic NewsAPI calls to ${b.length} sources`),0===b.length&&(console.log("All sources already covered recently, using a subset for refresh"),b=m.slice(0,3)),b))try{console.log(`Fetching headlines from ${e}...`);let t=`https://newsapi.org/v2/top-headlines?sources=${e}&pageSize=10&apiKey=${h}`,r=(await l.Z.get(t,{timeout:1e4,headers:{"Cache-Control":"no-cache"}})).data;r.articles&&r.articles.length>0&&(console.log(`Got ${r.articles.length} articles from ${e}`),r.articles.forEach(t=>{if(t.title&&t.url){let r=d(t.title+" "+(t.description||"")),s=function(e,t,r){let s=[e,t,r].filter(Boolean).join(" "),o={bias:"unknown",biasQuotes:[]},i=["progressive","liberal","democrat","social justice","equality","climate change","green","environmental","diversity","inclusion","marginalized","systemic","reform","regulation","workers","union","universal healthcare","gun control","reproductive rights","welfare","public option","medicare for all","wealth tax","income inequality","living wage","affordable housing","student loan forgiveness","police reform","defund","progressive","racial justice","gender equality","LGBTQ+","transgender","pronouns","privilege","structural racism","equity","affirmative action","reparations"],n=["conservative","republican","traditional","freedom","liberty","patriot","america first","free market","deregulation","tax cuts","small government","second amendment","pro-life","border security","illegal immigration","law and order","family values","religious liberty","constitutional","founding fathers","heritage","individual responsibility","school choice","tough on crime","national security","military strength","fiscal responsibility","private sector","job creators","limited government","states rights","voter ID","traditional marriage","sanctity of life","american exceptionalism","patriotism"],a=0,l=0,c=s.split(/[.!?]\s+/),u=[];for(let e of c){let t=0,r=0;for(let r of i)e.toLowerCase().includes(r.toLowerCase())&&(a++,t++);for(let t of n)e.toLowerCase().includes(t.toLowerCase())&&(l++,r++);(t>0||r>0)&&e.length>20&&e.length<300&&!u.includes(e)&&u.push(e.trim()+".")}if(u.length<2&&c.length>0){for(let e of c)if(e.length>40&&e.length<250&&!u.includes(e)&&(e.toLowerCase().includes("according to")||e.toLowerCase().includes("said")||e.toLowerCase().includes("stated")||e.toLowerCase().includes("believes")||e.toLowerCase().includes("argues")||e.toLowerCase().includes("claims")||e.toLowerCase().includes("suggests")||e.toLowerCase().includes("indicates"))&&(u.push(e.trim()+"."),u.length>=3))break}if(u.length<2&&c.length>0){for(let e of[...c].filter(e=>e.length>30&&e.length<250).sort((e,t)=>t.length-e.length))if(!u.includes(e)&&(u.push(e.trim()+"."),u.length>=3))break}return a>1.5*l?o.bias="left":l>1.5*a?o.bias="right":o.bias="center",o.biasQuotes=u.slice(0,3),o}(t.title,t.description||"",t.content||"");console.log(`Bias analysis for ${e}:`,{title:t.title.substring(0,30)+"...",bias:s.bias,quoteCount:s.biasQuotes.length,sampleQuote:s.biasQuotes[0]?.substring(0,50)+"..."}),f.push({...t,sourceId:e,keywords:r,bias:s.bias,biasQuotes:s.biasQuotes})}}))}catch(t){console.error(`Error fetching from ${e}:`,t)}if(console.log(`Collected ${f.length} total articles from all sources`),0===f.length)return console.log("No articles collected, likely due to rate limiting."),a.NextResponse.json({newsStories:[],timestamp:new Date().toISOString(),error:"Rate limit exceeded or no articles available"},{status:200});let w=[];for(let e of f){let t=!1;for(let r of w)if(r.articles.some(t=>(function(e,t){if(function(e,t){let r=e=>e.toLowerCase().replace(/[^\w\s]/g,"").replace(/\s+/g," ").trim(),s=r(e),o=r(t),i=s.split(" "),n=o.split(" "),a=0;for(let e of i)e.length>3&&n.includes(e)&&a++;return a/new Set([...i,...n]).size}(e.title,t.title)>.7)return!0;let r=p(e.title+" "+(e.description||"")),s=p(t.title+" "+(t.description||"")),o=0;for(let e of r)s.includes(e)&&o++;if(o>=2)return!0;let i=e.keywords||[],n=t.keywords||[],a=0;for(let e of i)n.includes(e)&&a++;return a>=3})(t,e))){r.articles.some(t=>t.source?.name===e.source?.name)||r.articles.push(e),t=!0;break}t||w.push({articles:[e],category:function(e,t,r){let s=(e+" "+t).toLowerCase()+" "+r.join(" ").toLowerCase();return/\b(us|united states|america|american|washington|biden|trump|congress|senate|house|white house)\b/.test(s)?"us":/\b(politic|election|vote|democrat|republican|congress|senate|house|president|administration|government|law|supreme court|bill|legislation)\b/.test(s)?"politics":/\b(world|global|international|europe|asia|africa|middle east|china|russia|ukraine|foreign|diplomatic|un|united nations)\b/.test(s)?"world":/\b(business|economy|economic|market|stock|finance|trade|company|corporate|inflation|recession|fed|federal reserve)\b/.test(s)?"business":/\b(tech|technology|digital|software|hardware|app|internet|cyber|ai|artificial intelligence|robot|innovation|startup)\b/.test(s)?"technology":/\b(health|medical|medicine|disease|virus|pandemic|doctor|hospital|patient|covid|vaccine|healthcare)\b/.test(s)?"health":/\b(science|scientific|research|study|discovery|space|nasa|physics|biology|chemistry|climate|environment)\b/.test(s)?"science":/\b(sport|game|match|team|player|championship|tournament|olympic|football|soccer|basketball|baseball|tennis|nfl|nba|mlb)\b/.test(s)?"sports":/\b(entertainment|movie|film|tv|television|show|celebrity|actor|actress|music|artist|concert|hollywood)\b/.test(s)?"entertainment":/\b(social|lifestyle|fashion|food|travel|celebrity|trend)\b/.test(s)?"social":"other"}(e.title,e.description,d(e.title+" "+e.description))})}let y=[],v=w.filter(e=>e.articles.length>=3);console.log(`Found ${v.length} events with at least 3 sources`);let I=v.length>=5?v.slice(0,10):[...v,...w.filter(e=>e.articles.length>=2).slice(0,10-v.length)];for(let e of(console.log(`Processing ${I.length} news events`),I)){let t=e.articles.reduce((e,t)=>{let r=(e.content?.length||0)+(e.description?.length||0);return(t.content?.length||0)+(t.description?.length||0)>r?t:e},e.articles[0]),r=e.articles.map(e=>({title:e.title,source:e.source?.name||e.sourceId,link:e.url})),s=t.description||"",o=[],i=[];for(let t of(console.log("Checking for bias in articles:",e.articles.length,"articles"),e.articles))if(console.log("Article source:",t.source?.name||t.sourceId),console.log("Has bias info:",!!t.bias,"Has bias quotes:",!!(t.biasQuotes&&t.biasQuotes.length>0)),t.sourceId&&t.bias&&t.biasQuotes&&t.biasQuotes.length>0){let e=t.source?.name||t.sourceId;i.some(t=>t.source===e)||(i.push({source:e,bias:t.bias,biasQuotes:t.biasQuotes}),console.log("Added bias info for source:",e,"with bias:",t.bias,"and quotes:",t.biasQuotes.length))}console.log("Total sources with bias info:",i.length);let n={headline:t.title||"Untitled Article",summary:s||"",sources:r||[],publishedAt:t.publishedAt,mainKeywords:t.keywords||[],category:e.category||"general",commonFacts:"",uniqueClaims:o.length>0?o:void 0,sourceBias:i.length>0?i:void 0,imageUrl:t.urlToImage||null};if(y.push(n),"function"==typeof g)try{let e={...n,news_type:"dynamic",id:crypto.randomUUID()};await g(e);let r=t.title?t.title.substring(0,30)+"...":"Untitled Article";console.log(`Saved story to Supabase: ${r}`)}catch(e){console.error("Error saving to Supabase:",e)}else console.log("Skipping Supabase save - saveNewsStory function not available")}return s(),a.NextResponse.json({newsStories:y,timestamp:new Date().toISOString()},{status:200})}catch(t){try{s()}catch(e){}console.error("Error in News API:",t);let e=t instanceof Error?t.message:"Failed to fetch news";return a.NextResponse.json({error:e,timestamp:new Date().toISOString()},{status:500})}}function d(e){if(!e)return[];let t=["a","an","the","and","or","but","is","are","was","were","be","been","being","in","on","at","to","for","with","by","about","against","between","into","through","during","before","after","above","below","from","up","down","of","off","over","under","again","further","then","once","here","there","when","where","why","how","all","any","both","each","few","more","most","other","some","such","no","nor","not","only","own","same","so","than","too","very","s","t","can","will","just","don","should","now"],r=e.toLowerCase().replace(/[^\w\s]/g,"").replace(/\s+/g," ").split(" ").filter(e=>e.length>3&&!t.includes(e)),s={};for(let e of r)s[e]=(s[e]||0)+1;return Object.keys(s).sort((e,t)=>s[t]-s[e]).slice(0,10)}function p(e){let t=[],r=e.split(/\s+/);for(let e=1;e<r.length;e++){let s=r[e].replace(/[^\w]/g,"");if(s.length>1&&/^[A-Z]/.test(s)){let o=s,i=e+1;for(;i<r.length;){let e=r[i].replace(/[^\w]/g,"");if(e.length>1&&/^[A-Z]/.test(e))o+=" "+e,i++;else break}t.push(o),e=i-1}}if(r.length>0){let e=r[0].replace(/[^\w]/g,"");e.length>1&&/^[A-Z]/.test(e)&&!/^(The|A|An|This|That|These|Those|It|He|She|They|We|I)$/i.test(e)&&t.push(e)}return Array.from(new Set(t))}h||console.error("NEWS_API_KEY environment variable is not set"),new c.YU({apiKey:process.env.ANTHROPIC_API_KEY});let f=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/news/route",pathname:"/api/news",filename:"route",bundlePath:"app/api/news/route"},resolvedPagePath:"C:\\Users\\chens\\AI and Coding\\Hackathons\\anthropic-wics\\src\\app\\api\\news\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:b,serverHooks:w,headerHooks:y,staticGenerationBailout:v}=f,I="/api/news/route";function S(){return(0,n.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:b})}},6517:(e,t,r)=>{let s;r.d(t,{O:()=>s});var o=r(86323);let i="https://ehbwpbxueiulrkgkfztz.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVoYndwYnh1ZWl1bHJrZ2tmenR6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUxMTE5MzcsImV4cCI6MjA2MDY4NzkzN30.-sDlsAcwi5idzohXrYWBVYZ-Jc0gsbJPu_7dSP9OQ98";try{if(i&&n)s=(0,o.eI)(i,n);else throw Error("Missing Supabase credentials")}catch(e){console.error("Error creating Supabase client:",e),s=(0,o.eI)("https://ehbwpbxueiulrkgkfztz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVoYndwYnh1ZWl1bHJrZ2tmenR6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUxMTE5MzcsImV4cCI6MjA2MDY4NzkzN30.-sDlsAcwi5idzohXrYWBVYZ-Jc0gsbJPu_7dSP9OQ98")}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,791,323,687,949],()=>r(88539));module.exports=s})();